@startuml
!include ../_template_styles.puml
' QUERY / REQUEST EXECUTION FLOW - Mixed layout for PPTX
left to right direction

component "**Client**\n<size:10>Query by user_id</size>" as C <<Primary>>

component "**1. Route**\n<size:10>hash(user_id) mod N</size>" as R <<Control>>

rectangle "PARTITIONS" #FFFFFF {
    database "**P0**\n<size:10>Users, Orders</size>" as P0 <<Schema>>
    database "**P1**\n<size:10>Users, Orders</size>" as P1 <<Schema>>
    database "**P2**\n<size:10>Users, Orders</size>" as P2 <<Schema>>
    P0 -[hidden]down- P1
    P1 -[hidden]down- P2
}

component "**3. Merge**\n<size:10>Result</size>" as M <<Task>>

database "**Response**\n<size:10>User + Orders</size>" as OUT <<Schema>>

C -right[#5C6BC0,thickness=2]-> R : <color:#3949AB>user_id=123</color>
R -right[#5C6BC0,thickness=2]-> P0 : <color:#3949AB>skip</color>
R -right[#5C6BC0,thickness=2]-> P1 : <color:#3949AB>P1 (key 123)</color>
R -right[#5C6BC0,thickness=2]-> P2 : <color:#3949AB>skip</color>
P1 -right[#00897B,thickness=2]-> M : <color:#3949AB>local read</color>
M -right[#00897B,thickness=2]-> OUT : <color:#3949AB>~1-5 ms</color>

@enduml
