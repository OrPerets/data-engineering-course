@startuml
!include ../_template_styles.puml
' DISTRIBUTED DB SYSTEM OVERVIEW - Mixed layout for PPTX
top to bottom direction

together {
    component "**App / Query**\n<size:10>Read / Write</size>" as CLIENT <<Primary>>
    component "**Router**\n<size:10>Route to partition</size>" as ROUTER <<Control>>
    component "**Partition Map**\n<size:10>hash(key) mod N</size>" as PMAP <<Schema>>
}

rectangle "DATA NODES" #FFFFFF {
    database "**Node 1**\n<size:10>P0, P3</size>" as N1 <<Schema>>
    database "**Node 2**\n<size:10>P1, P4</size>" as N2 <<Schema>>
    database "**Node 3**\n<size:10>P2, P5</size>" as N3 <<Schema>>
    N1 -[hidden]right- N2
    N2 -[hidden]right- N3
}

component "**Replication**\n<size:10>Sync / async</size>" as REPL <<Control>>

CLIENT -right[#5C6BC0,thickness=2]-> ROUTER : <color:#3949AB>request</color>
ROUTER -right[#5C6BC0,thickness=2]-> PMAP : <color:#3949AB>lookup</color>
ROUTER -down[#5C6BC0,thickness=2]-> N1 : <color:#3949AB>P0/P3</color>
ROUTER -down[#5C6BC0,thickness=2]-> N2 : <color:#3949AB>P1/P4</color>
ROUTER -down[#5C6BC0,thickness=2]-> N3 : <color:#3949AB>P2/P5</color>
N1 -down[#00897B,thickness=2]-> REPL : <color:#3949AB>sync</color>
N2 -down[#00897B,thickness=2]-> REPL : <color:#3949AB>sync</color>
N3 -down[#00897B,thickness=2]-> REPL : <color:#3949AB>sync</color>

@enduml
