@startuml
' Control table: last_as_of_ts; update only after successful write
' Incremental: read control -> compute new -> MERGE -> update control

left to right direction
skinparam linetype ortho
skinparam shadowing false
skinparam roundcorner 8
skinparam handwritten false
skinparam nodesep 50
skinparam ranksep 45

skinparam defaultFontName "Segoe UI, Helvetica, sans-serif"
skinparam defaultFontSize 16
skinparam defaultFontColor #2C3E50
skinparam rectangle {
    BackgroundColor #F8F9FA
    BorderColor #90A4AE
    BorderThickness 2
    FontSize 14
    Padding 12
}
skinparam component {
    BackgroundColor #FFFFFF
    BorderColor #78909C
    BorderThickness 1.5
    FontSize 14
    Padding 10
}
skinparam database {
    BackgroundColor #ECEFF1
    BorderColor #546E7A
    BorderThickness 1.5
    FontSize 14
}
skinparam arrow {
    Color #607D8B
    Thickness 2.5
    FontSize 11
}

database "**Control**\n<size:12>last_as_of_ts</size>" as CTRL #ECEFF1

component "**Read watermark**" as R

component "**Compute**\n<size:12>new_as_of_ts only</size>" as C #E1F5FE

component "**MERGE / overwrite**" as W #E8F5E9

component "**Update control**\n<size:12>Only after success</size>" as U #C8E6C9

CTRL -right-> R
R -right-> C
C -right-> W
W -right-> U
U -right-> CTRL
@enduml
