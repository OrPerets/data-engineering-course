@startuml
!include ../_template_styles.puml
' FAILURE: DATA SKEW (HOT KEY -> ONE REDUCER) - Mixed layout for PPTX
top to bottom direction

component "**Partition by hash(key)**\n<size:10>Keys -> Reducers</size>" as PART <<Control>>

rectangle "REDUCERS" #FFFFFF {
    component "**R1**\n<size:10>10 keys, 1M vals</size>" as R1 <<Task>>
    component "**R2**\n<size:10>10 keys, 1M vals</size>" as R2 <<Task>>
    component "**R3 (HOT)**\n<size:10>1 key, 800M vals</size>" as R3 <<Failure>>
    R1 -[hidden]right- R2
    R2 -[hidden]right- R3
}

together {
    database "**Done**" as D1 <<up>>
    database "**Done**" as D2 <<up>>
    component "**OOM / Timeout**\n<size:10>Overloaded</size>" as FAIL <<failure>>
}

component "**Mitigation**\n<size:10>salting / combiner</size>" as FIX <<Control>>

PART -down[#5C6BC0,thickness=2]-> R1 : <color:#3949AB>balanced</color>
PART -down[#5C6BC0,thickness=2]-> R2 : <color:#3949AB>balanced</color>
PART -down[#D32F2F,thickness=2]-> R3 : <color:#3949AB>hot key</color>

R1 -down[#00897B,thickness=2]-> D1
R2 -down[#00897B,thickness=2]-> D2
R3 -down[#D32F2F,thickness=2]-> FAIL : <color:#3949AB>crash</color>
FAIL -down[#5C6BC0,thickness=2]-> FIX : <color:#3949AB>rebalance</color>

@enduml
