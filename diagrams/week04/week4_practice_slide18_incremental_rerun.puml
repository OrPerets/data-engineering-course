@startuml
'=================================================
' INCREMENTAL LOAD + RERUN (NO DUPLICATES) - Mixed layout for PPTX
'=================================================

!include ../_template_styles.puml

top to bottom direction

database "**Control**\n<size:10>watermark</size>" as CTRL <<Schema>>

component "**Read watermark**\n<size:10>Get last_ts</size>" as READ <<Task>>

database "**Source**\n<size:10>Partitioned</size>" as SRC <<Primary>>

component "**Extract slice**\n<size:10>WHERE ts > wm</size>" as EXTRACT <<Task>>

component "**Transform**\n<size:10>Dedup</size>" as TRANSFORM <<Task>>

component "**MERGE**\n<size:10>ON CONFLICT</size>" as MERGE <<Control>>

database "**Target**\n<size:10>No dups</size>" as TGT <<success>>

CTRL -right-> READ : "1"
READ -right-> EXTRACT : "2"
SRC -down-> EXTRACT
EXTRACT -right-> TRANSFORM : "3"
TRANSFORM -right-> MERGE : "4"
MERGE -right-> TGT
MERGE -down-> CTRL : "5 update"

@enduml
