@startuml
'=================================================
' BAD ARCHITECTURE vs CORRECT - Mixed layout for PPTX
'=================================================

!include ../_template_styles.puml

top to bottom direction

rectangle "BAD (fails in production)" <<Failure>> {
    database "**Source**\n<size:10>raw_events</size>" as SRC_BAD
    component "**INSERT**\n<size:10>No staging</size>" as INS_BAD <<Failure>>
    database "**Target**\n<size:10>Duplicates</size>" as TGT_BAD <<Failure>>
    SRC_BAD -right-> INS_BAD : "full"
    INS_BAD -right-> TGT_BAD : "2Ã— rows"
}

rectangle "CORRECT" <<Task>> {
    database "**Source**\n<size:10>raw_events</size>" as SRC_OK <<Primary>>
    component "**Extract**\n<size:10>Watermark</size>" as EXT <<Task>>
    database "**Staging**\n<size:10>Dedup</size>" as STG <<Primary>>
    component "**MERGE**\n<size:10>Idempotent</size>" as MERGE <<Control>>
    database "**Target**\n<size:10>clean</size>" as TGT_OK <<success>>
    database "**Control**\n<size:10>watermark</size>" as CTRL <<Schema>>
    SRC_OK -right-> EXT
    EXT -right-> STG
    STG -right-> MERGE
    MERGE -right-> TGT_OK
    MERGE -down-> CTRL : "update"
}

@enduml
