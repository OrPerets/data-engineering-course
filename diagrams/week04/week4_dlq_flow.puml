@startuml
'=================================================
' DLQ FLOW - Valid to target, invalid to DLQ
' Schema-on-read: bad rows do not kill batch
'=================================================

!include ../_template_styles.puml

left to right direction

database "**Staging**\n<size:12>Raw load</size>\n<size:12>schema-on-read</size>" as STG <<Primary>>

component "**Validate**\n<size:12>Cast / filter</size>\n<size:12>per row</size>" as VALID <<Task>>

database "**Target**\n<size:12>events_clean</size>" as TGT <<success>>

database "**DLQ**\n<size:12>raw row, error_reason</size>\n<size:12>ingest_ts</size>" as DLQ <<Failure>>

STG -right-> VALID : <size:11>read</size>
VALID -right[#00897B,thickness=2]-> TGT : <size:11>valid</size>
VALID -down[#D32F2F,thickness=3]-> DLQ : <size:11>invalid</size>

@enduml
