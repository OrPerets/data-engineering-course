@startuml
'=================================================
' MERGE vs PARTITION OVERWRITE - Load options
' Row-level upsert vs replace partition
'=================================================

!include ../_template_styles.puml

left to right direction

rectangle "**MERGE / Upsert**\n\n<size:14>ON key match: update or insert</size>\n<size:14>Rerun safe (idempotent)</size>\n\n<size:13>Pros: handles duplicates, late updates</size>\n<size:13>Cons: join cost; needs index</size>" as MERGE <<Task>>

rectangle "**Partition Overwrite**\n\n<size:14>Replace whole partition (e.g. by date)</size>\n<size:14>Idempotent at partition level</size>\n\n<size:13>Pros: simple, no join</size>\n<size:13>Cons: full partition reload only</size>" as OVER <<Schema>>

rectangle "**Choose**\n\n<size:14>MERGE: row-level upsert</size>\n<size:14>Overwrite: full day reload</size>" as CHOICE <<Control>>

MERGE -down[#00897B,thickness=2]-> CHOICE
OVER -down[#FF6F00,thickness=2]-> CHOICE

@enduml
