@startuml
'=================================================
' FAILURE: PARTIAL RUN AND IDEMPOTENT RERUN - Mixed layout for PPTX
'=================================================

!include ../_template_styles.puml

top to bottom direction

rectangle "RUN 1" <<Primary>> {
    component "**P1**\n<size:10>2025-12-01</size>" as P1 <<Task>>
    component "**P2**\n<size:10>2025-12-02</size>" as P2 <<Task>>
    component "**P3**\n<size:10>2025-12-03</size>" as P3 <<Failure>>
    P1 -[hidden]right- P2
    P2 -[hidden]right- P3
}

database "**Target**\n<size:10>P1, P2 written</size>" as TARGET <<Primary>>

rectangle "RUN 2 (Rerun)" <<Task>> {
    component "**Skip P1, P2**\n<size:10>Committed</size>" as SKIP <<Control>>
    component "**Process P3**\n<size:10>Idempotent</size>" as P3B <<Task>>
    SKIP -right-> P3B : "resume"
}

P1 -down-> TARGET : "OK"
P2 -down-> TARGET : "OK"
P3 -[#D32F2F]down-> TARGET : "fails"

P3B -down-> TARGET : "write P3"

@enduml
