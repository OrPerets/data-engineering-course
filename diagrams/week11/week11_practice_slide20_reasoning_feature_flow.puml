@startuml
'=================================================
' CANONICAL DIAGRAM TEMPLATE â€” DATA ENGINEERING
'=================================================

top to bottom direction
skinparam linetype ortho
skinparam shadowing false
skinparam roundcorner 8
skinparam handwritten false
skinparam nodesep 30
skinparam ranksep 40

skinparam defaultFontName "Segoe UI", "Helvetica", sans-serif
skinparam defaultFontSize 16
skinparam defaultFontColor #2C3E50

skinparam rectangle { BackgroundColor #F8F9FA; BorderColor #90A4AE; BorderThickness 2; FontColor #263238; FontSize 14; FontStyle bold; Padding 20 }
skinparam component { BackgroundColor #FFFFFF; BorderColor #78909C; BorderThickness 1.5; FontSize 14; Padding 12 }
skinparam database { BackgroundColor #ECEFF1; BorderColor #546E7A; BorderThickness 1.5; FontSize 14; FontColor #263238 }
skinparam arrow { Color #607D8B; Thickness 1.5; FontSize 11; FontColor #546E7A }
skinparam component<<Tool>> { BorderColor #2E7D32; BackgroundColor #E8F5E9; FontColor #1B5E20 }

'========================
' PRACTICE: FEATURE PIPELINE REASONING
'========================

rectangle "DATA" #F8F9FA {
    database "**events**\n<size:10>user_id, ts, type</size>" as EVT
    database "**users**\n<size:10>user_id, signup_ts</size>" as USR
}

rectangle "FEATURE JOB" #F8F9FA {
    component "**Aggregate**\n<size:10>COUNT last 7d</size>" as AGG <<Tool>>
    component "**Join**\n<size:10>As-of user state</size>" as JOIN <<Tool>>
    component "**Write**\n<size:10>entity_id, as_of_ts, f1</size>" as WRITE <<Tool>>
}

database "**user_features**\n<size:10>PK (user_id, as_of_ts)</size>" as FT

EVT --> AGG
USR --> JOIN
AGG --> JOIN
JOIN --> WRITE
WRITE --> FT

note bottom of JOIN : **Point-in-time:** join only rows where ts <= as_of_ts.
note bottom of WRITE : **Idempotent:** overwrite partition or MERGE on key.

@enduml
