@startuml
!include ../_template_styles.puml
' DATA ENGINEERING LIFECYCLE - mixed layout
top to bottom direction

package "SOURCES" #FFFFFF {
    storage "**Logs**\n<size:12>10M/day JSON</size>" as SOURCE1 <<Primary>>
    database "**Users**\n<size:12>100M PG</size>" as SOURCE2 <<Primary>>
    database "**Products**\n<size:12>1M Mongo</size>" as SOURCE3 <<Control>>
}

package "INGESTION" #FFFFFF {
    component "**Extract**\n<size:11>Read & validate</size>" as INGEST <<Control>>
}

package "STORAGE" #FFFFFF {
    database "**Raw**\n<size:12>Lake Parquet</size>\n<size:12>5 GB/day</size>" as RAW <<Schema>>
}

package "PROCESSING" #FFFFFF {
    together {
        component "**Transform**\n<size:11>Clean & enrich</size>" as TRANSFORM <<Task>>
        component "**Aggregate**\n<size:11>Rollup metrics</size>" as AGGREGATE <<Task>>
    }
}

package "CONSUMPTION" #FFFFFF {
    database "**Warehouse**\n<size:12>Star schema</size>" as WAREHOUSE <<Schema>>
    together {
        component "**Analytics**\n<size:11>BI tools</size>" as DASHBOARD <<Primary>>
        component "**ML**\n<size:11>Features</size>" as ML <<Task>>
    }
}

SOURCE1 -down[#5C6BC0,thickness=2]-> INGEST
SOURCE2 -down[#5C6BC0,thickness=2]-> INGEST
SOURCE3 -down[#5C6BC0,thickness=2]-> INGEST

INGEST -right[#FF6F00,thickness=2]-> RAW : <color:#3949AB><b>5GB/day</b></color>

RAW -down[#5C6BC0,thickness=2]-> TRANSFORM : <color:#3949AB>Read</color>
TRANSFORM -right[#5C6BC0,thickness=2]-> AGGREGATE : <color:#3949AB>Filter</color>
AGGREGATE -down[#00897B,thickness=2]-> WAREHOUSE : <color:#3949AB><b>5MB</b></color>

WAREHOUSE -right[#1565C0,thickness=2]-> DASHBOARD : <color:#3949AB>Query</color>
WAREHOUSE -down[#00897B,thickness=2]-> ML : <color:#3949AB>Features</color>

@enduml
